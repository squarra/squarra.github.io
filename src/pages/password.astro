---
import Layout from "@layouts/Layout.astro";
import "@styles/global.css";
---

<Layout>
    <div class="password-generator">
        <button id="generate">Generate Password</button>
        <div id="password"></div>
        <div id="copied" class="copied-message">Copied!</div>
    </div>
</Layout>

<script>
    function generatePassword() {
        const vowels = "aeiou";
        const consonants = "bcdfghjklmnpqrstvwxyz";

        function randomChoice(str) {
            return str[Math.floor(Math.random() * str.length)];
        }

        function generateChunk() {
            const pattern = ["C", "V", "C", "C", "V", "C"];
            return pattern
                .map((p) =>
                    p === "C" ? randomChoice(consonants) : randomChoice(vowels),
                )
                .join("");
        }

        const chars = (generateChunk() + generateChunk()).split("");

        // Insert one digit
        const digitIndex = Math.floor(Math.random() * chars.length);
        chars[digitIndex] = Math.floor(Math.random() * 10).toString();

        // Insert one uppercase letter
        let uppercaseIndex = digitIndex;
        while (uppercaseIndex === digitIndex) {
            uppercaseIndex = Math.floor(Math.random() * chars.length);
        }
        chars[uppercaseIndex] = chars[uppercaseIndex].toUpperCase();

        return chars.slice(0, 6).join("") + "-" + chars.slice(6).join("");
    }

    document.getElementById("generate").addEventListener("click", () => {
        const passwordEl = document.getElementById("password");
        if (passwordEl) {
            passwordEl.textContent = generatePassword();
        }
    });

    document.getElementById("password").addEventListener("click", async () => {
        const passwordEl = document.getElementById("password");
        const copiedEl = document.getElementById("copied");

        if (passwordEl && passwordEl.textContent && copiedEl) {
            await navigator.clipboard.writeText(passwordEl.textContent);

            copiedEl.classList.add("show");
            setTimeout(() => {
                copiedEl.classList.remove("show");
            }, 1500);
        }
    });
</script>

<style>
    .password-generator {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        align-items: center;
        padding: 2rem;
    }

    #password {
        font-family: monospace;
        cursor: pointer;
        user-select: all;
    }

    #password:hover {
        opacity: 0.7;
    }

    .copied-message {
        opacity: 0;
        transition: opacity 0.2s;
        font-size: 0.875rem;
        color: green;
    }

    .copied-message.show {
        opacity: 1;
    }
</style>
